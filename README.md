# Kaggle_Google-Brain-Ventilator-Pressure-Prediction

# Description
æ‚£è€…ãŒå‘¼å¸å›°é›£ã«é™¥ã£ãŸã¨ãã€åŒ»å¸«ã¯ä½•ã‚’ã™ã‚‹ã®ã ã‚ã†ã‹ã€‚äººå·¥å‘¼å¸å™¨ã‚’ä½¿ã£ã¦ã€é®é™çŠ¶æ…‹ã®æ‚£è€…ã®è‚ºã«æ°—ç®¡ã‹ã‚‰é…¸ç´ ã‚’é€ã‚Šè¾¼ã‚€ã®ã ã€‚ã—ã‹ã—ã€äººå·¥å‘¼å¸ã¯è‡¨åºŠåŒ»ã®æ‰‹ãŒå¿…è¦ã§ã‚ã‚Šã€ãã®é™ç•Œã¯COVID-19ãƒ‘ãƒ³ãƒ‡ãƒŸãƒƒã‚¯ã®åˆæœŸã«é¡•è‘—ã«ç¾ã‚Œã¾ã—ãŸã€‚åŒæ™‚ã«ã€æ©Ÿæ¢°å¼äººå·¥å‘¼å¸å™¨ã‚’åˆ¶å¾¡ã™ã‚‹æ–°ã—ã„æ–¹æ³•ã‚’é–‹ç™ºã™ã‚‹ã«ã¯ã€è‡¨åºŠè©¦é¨“ã«è‡³ã‚‹ã¾ã§ã«è«å¤§ãªè²»ç”¨ãŒã‹ã‹ã‚Šã¾ã™ã€‚é«˜å“è³ªã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã€ã“ã®éšœå£ã‚’æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

ç¾åœ¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã€å„ãƒ¢ãƒ‡ãƒ«ãŒå˜ä¸€ã®è‚ºã®è¨­å®šã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ã¨ã—ã¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€è‚ºã¨ãã®å±æ€§ã¯é€£ç¶šã—ãŸç©ºé–“ã‚’å½¢æˆã—ã¦ã„ã‚‹ãŸã‚ã€æ‚£è€…ã®è‚ºã®é•ã„ã‚’è€ƒæ…®ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¤œè¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Google Brainã®ãƒãƒ¼ãƒ ã¯ã€ãƒ—ãƒªãƒ³ã‚¹ãƒˆãƒ³å¤§å­¦ã¨ææºã—ã€äººå·¥å‘¼å¸åˆ¶å¾¡ã®ãŸã‚ã®æ©Ÿæ¢°å­¦ç¿’ã‚’ã‚ãã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ç™ºå±•ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨æ·±å±¤å­¦ç¿’ã¯ã€ç¾åœ¨ã®æ¥­ç•Œæ¨™æº–ã§ã‚ã‚‹PIDåˆ¶å¾¡ã‚ˆã‚Šã‚‚ã€ã•ã¾ã–ã¾ãªç‰¹æ€§ã‚’æŒã¤è‚ºã‚’ã‚ˆã‚Šã‚ˆãä¸€èˆ¬åŒ–ã§ãã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

ã“ã®ã‚³ãƒ³ãƒšãƒ†ã‚£ã‚·ãƒ§ãƒ³ã§ã¯ã€é®é™çŠ¶æ…‹ã®æ‚£è€…ã®è‚ºã«æ¥ç¶šã•ã‚ŒãŸäººå·¥å‘¼å¸å™¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã„ã¾ã™ã€‚å„ªç§€ãªä½œå“ã¯ã€è‚ºã®ç‰¹æ€§ã§ã‚ã‚‹ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã¨æŠµæŠ—ã‚’è€ƒæ…®ã—ã¦ã„ã¾ã™ã€‚

æˆåŠŸã™ã‚Œã°ã€æ©Ÿæ¢°å¼äººå·¥å‘¼å¸å™¨ã‚’åˆ¶å¾¡ã™ã‚‹æ–°ã—ã„æ–¹æ³•ã‚’é–‹ç™ºã™ã‚‹éš›ã®ã‚³ã‚¹ãƒˆé¢ã§ã®éšœå£ã‚’å…‹æœã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€æ‚£è€…ã«é©å¿œã—ãŸã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã¸ã®é“ãŒé–‹ã‹ã‚Œã€ã“ã®æ–¬æ–°ãªæ™‚ä»£ã¨ãã‚Œä»¥é™ã®æ™‚ä»£ã«ãŠã„ã¦ã€è‡¨åºŠåŒ»ã®è² æ‹…ã‚’è»½æ¸›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ãã®çµæœã€æ‚£è€…ã•ã‚“ã®å‘¼å¸ã‚’åŠ©ã‘ã‚‹ãŸã‚ã®äººå·¥å‘¼å¸å™¨ã®æ²»ç™‚æ³•ãŒã‚ˆã‚Šåºƒãæ™®åŠã™ã‚‹ã“ã¨ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

# Evaluation
ç«¶æŠ€ã¯ã€å„å‘¼å¸ã®å¸æ°—æ®µéšã«ãŠã‘ã‚‹äºˆæ¸¬åœ§åŠ›ã¨å®Ÿéš›ã®åœ§åŠ›ã®é–“ã®å¹³å‡çµ¶å¯¾èª¤å·®ã¨ã—ã¦æ¡ç‚¹ã•ã‚Œã¾ã™ã€‚å‘¼æ°—ç›¸ã¯æ¡ç‚¹ã•ã‚Œãªã„ã€‚ã‚¹ã‚³ã‚¢ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä¸ãˆã‚‰ã‚Œã‚‹ã€‚

$$|ğ‘‹âˆ’ğ‘Œ|$$
ã“ã“ã§ã€ğ‘‹ã¯äºˆæ¸¬åœ§åŠ›ã®ãƒ™ã‚¯ãƒˆãƒ«ã€ğ‘Œã¯ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã®å…¨å‘¼å¸ã«ãŠã‘ã‚‹å®Ÿéš›ã®åœ§åŠ›ã®ãƒ™ã‚¯ãƒˆãƒ«ã§ã‚ã‚‹ã€‚

## æå‡ºãƒ•ã‚¡ã‚¤ãƒ«
ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã®å„idã«ã¤ã„ã¦ã€åœ§åŠ›å¤‰æ•°ã®å€¤ã‚’äºˆæ¸¬ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å«ã¿ã€ä»¥ä¸‹ã®å½¢å¼ã§ä½œæˆã—ã¦ãã ã•ã„ã€‚

```
id,pressure
1,20
2,23
3,24
etc.
```

# Data
æœ¬å¤§ä¼šã§ä½¿ç”¨ã—ãŸäººå·¥å‘¼å¸å™¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®äººå·¥å‘¼å¸å™¨ã‚’æ”¹é€ ã—ã€å‘¼å¸å›è·¯ã‚’ä»‹ã—ã¦äººå·¥è›‡è…¹è©¦é¨“è‚ºã«æ¥ç¶šã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚ä¸‹å›³ã¯ãã®è¨­å®šã‚’ç¤ºã—ãŸã‚‚ã®ã§ã€2ã¤ã®åˆ¶å¾¡å…¥åŠ›ã‚’ç·‘ã§ã€äºˆæ¸¬ã™ã‚‹çŠ¶æ…‹å¤‰æ•°ï¼ˆæ°—é“åœ§ï¼‰ã‚’é’ã§ç¤ºã—ã¦ã„ã¾ã™ã€‚1ã¤ç›®ã®åˆ¶å¾¡å…¥åŠ›ã¯ï¼Œ0ã€œ100ã®é€£ç¶šå¤‰æ•°ã§ï¼Œç©ºæ°—ã‚’è‚ºã«å…¥ã‚Œã‚‹ãŸã‚ã«å¸æ°—é›»ç£å¼ã‚’é–‹ãå‰²åˆã‚’è¡¨ã—ã¾ã™ï¼ˆã™ãªã‚ã¡ï¼Œ0ã¯å®Œå…¨ã«é–‰ã˜ã¦ç©ºæ°—ã‚’å…¥ã‚Œãšï¼Œ100ã¯å®Œå…¨ã«é–‹ãã¾ã™ï¼‰ã€‚2ã¤ç›®ã®åˆ¶å¾¡å…¥åŠ›ã¯ã€ç©ºæ°—ã‚’å‡ºã™ãŸã‚ã®æ¢ç´¢é›»ç£å¼ãŒé–‹ã„ã¦ã„ã‚‹ï¼ˆ1ï¼‰ã‹é–‰ã˜ã¦ã„ã‚‹ï¼ˆ0ï¼‰ã‹ã‚’è¡¨ã™äºŒå€¤å¤‰æ•°ã§ã™ã€‚

ã“ã®ç«¶æŠ€ã§ã¯ï¼Œå‚åŠ è€…ã«å¤šæ•°ã®å‘¼å¸ã®æ™‚ç³»åˆ—ãŒä¸ãˆã‚‰ã‚Œï¼Œåˆ¶å¾¡å…¥åŠ›ã®æ™‚ç³»åˆ—ãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã«ï¼Œå‘¼å¸æ™‚ã®å‘¼å¸å›è·¯å†…ã®æ°—é“åœ§åŠ›ã‚’äºˆæ¸¬ã™ã‚‹ã“ã¨ã‚’å­¦ç¿’ã™ã‚‹ï¼  
<img width="732" alt="Screen Shot 2021-09-30 at 22 18 18" src="https://user-images.githubusercontent.com/71954051/135462647-b02c2f5d-522e-4987-89db-aa64dbb8c1dd.png">

å„æ™‚ç³»åˆ—ã¯ã€ç´„3ç§’é–“ã®å‘¼å¸ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€å„è¡ŒãŒå‘¼å¸ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—ã¨ãªã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€å¾Œè¿°ã™ã‚‹2ã¤ã®åˆ¶å¾¡ä¿¡å·ã€ãã®çµæœã¨ã—ã¦ã®æ°—é“åœ§åŠ›ã€ãŠã‚ˆã³è‚ºã®é–¢é€£å±æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

## Files
- train.csv - ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚»ãƒƒãƒˆ
- test.csv - ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆ
- sample_submission.csv - æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ä½œæˆã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«æŠ•ç¨¿ãƒ•ã‚¡ã‚¤ãƒ«

## Columns
- breath_id - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¸€æ„ãªå‘¼å¸ã®ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—
- R - æ°—é“ãŒã©ã®ç¨‹åº¦åˆ¶é™ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¤ºã™è‚ºå±æ€§ï¼ˆå˜ä½ï¼šcmH2O/L/Sï¼‰ã€‚ç‰©ç†çš„ã«ã¯ã€æµé‡ï¼ˆæ™‚é–“å½“ãŸã‚Šã®ç©ºæ°—é‡ï¼‰ã®å¤‰åŒ–ã«å¯¾ã™ã‚‹åœ§åŠ›ã®å¤‰åŒ–ã§ã™ã€‚ç›´æ„Ÿçš„ã«ã¯ã€ã‚¹ãƒˆãƒ­ãƒ¼ã§é¢¨èˆ¹ã‚’è†¨ã‚‰ã¾ã›ã‚‹ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚ã‚¹ãƒˆãƒ­ãƒ¼ã®ç›´å¾„ã‚’å¤‰ãˆã‚‹ã“ã¨ã§Rã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã€RãŒå¤§ãã„ã»ã©å¹ãã«ãããªã‚Šã¾ã™ã€‚
- C - è‚ºã®é©åˆæ€§ã‚’ç¤ºã™è‚ºå±æ€§ï¼ˆå˜ä½ï¼šmL/cmH2Oï¼‰ã€‚ç‰©ç†çš„ã«ã¯ã€åœ§åŠ›ã®å¤‰åŒ–ã«å¯¾ã™ã‚‹ä½“ç©ã®å¤‰åŒ–ã‚’è¡¨ã—ã¾ã™ã€‚ç›´æ„Ÿçš„ã«ã¯ã€åŒã˜é¢¨èˆ¹ã®ä¾‹ã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚é¢¨èˆ¹ã®ãƒ©ãƒ†ãƒƒã‚¯ã‚¹ã®åšã•ã‚’å¤‰ãˆã‚‹ã“ã¨ã§Cã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚CãŒå¤§ãã„ã»ã©ãƒ©ãƒ†ãƒƒã‚¯ã‚¹ãŒè–„ãã€å¹ãã‚„ã™ããªã‚Šã¾ã™ã€‚
- time_step - å®Ÿéš›ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã§ã™ã€‚
- u_in - å¸æ°—ã‚½ãƒ¬ãƒã‚¤ãƒ‰ãƒãƒ«ãƒ–ã®åˆ¶å¾¡å…¥åŠ›ã§ã™ã€‚0ï½100ã®ç¯„å›²ã§è¨­å®šã§ãã¾ã™ã€‚
- u_out - æ¢ç´¢ç”¨ã‚½ãƒ¬ãƒã‚¤ãƒ‰ãƒãƒ«ãƒ–ã®åˆ¶å¾¡å…¥åŠ›ã§ã™ã€‚0ã¾ãŸã¯1ã®ã„ãšã‚Œã‹ã§ã™ã€‚
- pressure - å‘¼å¸å›è·¯ã§æ¸¬å®šã•ã‚ŒãŸæ°—é“ã®åœ§åŠ›ã§ã€å˜ä½ã¯cmH2Oã§ã™ã€‚

# Log
## 20210930
- join
- LSTMå®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„

## 20211001
### GB_nb000
- [Deep Learning Starter : Simple LSTM](https://www.kaggle.com/theoviel/deep-learning-starter-simple-lstm)å†™çµŒ
- breath_idã”ã¨ã«input, outputã‚’è¨­å®š

## 20211002, 1003
- æ˜¨æ—¥ã®ç¶šã
- å†™çµŒçµ‚äº†
- ã‚³ãƒ¼ãƒ‰ã¯30%ãã‚‰ã„ç†è§£
- LSTMã®ç†è«–å‹‰å¼·ã—ãªãã‚ƒ

## 20211012
### GB_nb002
- [reject]ç‰¹å¾´é‡è¿½åŠ 
    - div_R_C
    - div_C_R
    - R, C ; strã€€â†’ R, C ; float
- 0.70237, 0.64347, 0.69892, 0.63648, 0.68166, 0.71558, 0.69029, 0.72464, 0.70306, 0.66260
- 0.685907

- å…¬é–‹ã‚³ãƒ¼ãƒ‰
- 0.70344, 0.64502, 0.69168, 0.65081, 0.70669, 0.72130, 0.64494, 0.71879, 0.69937, 0.63291
- 0.681492

- [reject]input_dim=1024â†’2048, 5å±¤
- fold9 val_loss=0.18

- 5fold
- å…¬é–‹code
- 0.75152, 0.74191, 0.72600, 0.69858, 0.66520
- 0.716642

- lag5è¿½åŠ (debug)
- 0.69271, 0.68639, 0.70154, 0.68344, 0.70840
- 0.694496

- lag6è¿½åŠ 
- 0.72801, 0.70793, 0.74417

## 20211014
### å…¬é–‹code;: gb-nb003
- baseline
- 5fold
- debug=True
- seed=71
- fold: 0.70642, 0.70791, 0.71608, 0.67396, 0.72496
- cv: 0.705866


### gb-nb004
- 5fold
- debug=True
- seed=71
- add: last_value_u_in
- fold: 0.73872, 0.68623, 0.68638, 0.66329, 0.63300
- cv: 0.681524


### gb-ng002
- 5fold
- debug=False
- add: lag5

### gb-nb004
- 5fold
- debug=True
- seed=71
- add: lag5, last_value_u_in
- fold: 0.71884, 0.70275, 0.69137, 0.75560, 0.64964
- cv: 0.70364

### gb-nb004
- 5fold
- debug=False
- seed=71
- add: last_value_u_in
- fold: 
- cv:
- lb: 

## 20211019
- ãƒ¡ãƒ¢ã‚µãƒœã£ã¦ãŸ
### gb-nb008
- gb-nb007ã‚’classifierã«ã™ã‚‹ 

## 20211020
### gb-nb008
-[GB - VPP - Whoppity dub dub](https://www.kaggle.com/dlaststark/gb-vpp-whoppity-dub-dub)ã®ç‰¹å¾´é‡ã‹ã‚‰outã«é–¢ã™ã‚‹ã‚‚ã®ã‚’å¼•ã„ãŸ
- 
```
def add_features(df):
    df['cross']= df['u_in']*df['u_out']
    df['cross2']= df['time_step']*df['u_out']
    df['area'] = df['time_step'] * df['u_in']
    df['area'] = df.groupby('breath_id')['area'].cumsum()
    df['time_step_cumsum'] = df.groupby(['breath_id'])['time_step'].cumsum()
    df['u_in_cumsum'] = (df['u_in']).groupby(df['breath_id']).cumsum()


    df['u_in_lag1'] = df.groupby('breath_id')['u_in'].shift(1)
    df['u_in_lag_back1'] = df.groupby('breath_id')['u_in'].shift(-1)
    df['u_in_lag2'] = df.groupby('breath_id')['u_in'].shift(2)
    df['u_in_lag_back2'] = df.groupby('breath_id')['u_in'].shift(-2)
    df['u_in_lag3'] = df.groupby('breath_id')['u_in'].shift(3)
    df['u_in_lag_back3'] = df.groupby('breath_id')['u_in'].shift(-3)
    df['u_in_lag4'] = df.groupby('breath_id')['u_in'].shift(4)
    df['u_in_lag_back4'] = df.groupby('breath_id')['u_in'].shift(-4)

    df = df.fillna(0)
    
    df['breath_id__u_in__max'] = df.groupby(['breath_id'])['u_in'].transform('max')
    df['breath_id__u_out__max'] = df.groupby(['breath_id'])['u_out'].transform('max')
    df['breath_id__u_in__diffmax'] = df.groupby(['breath_id'])['u_in'].transform('max') - df['u_in']
    df['breath_id__u_in__diffmean'] = df.groupby(['breath_id'])['u_in'].transform('mean') - df['u_in']

    df['u_in_diff1'] = df['u_in'] - df['u_in_lag1']
    df['u_in_diff2'] = df['u_in'] - df['u_in_lag2']
    df['u_in_diff3'] = df['u_in'] - df['u_in_lag3']
    df['u_in_diff4'] = df['u_in'] - df['u_in_lag4']
    
    df['one'] = 1
    df['count'] = (df['one']).groupby(df['breath_id']).cumsum()
    df['u_in_cummean'] = df['u_in_cumsum'] / df['count']
    
    df['breath_id_lag'] = df['breath_id'].shift(1).fillna(0)
    df['breath_id_lag2'] = df['breath_id'].shift(2).fillna(0)
    df['breath_id_lagsame'] = np.select([df['breath_id_lag']==df['breath_id']],[1],0)
    df['breath_id_lag2same'] = np.select([df['breath_id_lag2']==df['breath_id']], [1], 0)
    df['breath_id__u_in_lag'] = df['u_in'].shift(1).fillna(0)
    df['breath_id__u_in_lag'] = df['breath_id__u_in_lag'] * df['breath_id_lagsame']
    df['breath_id__u_in_lag2'] = df['u_in'].shift(2).fillna(0)
    df['breath_id__u_in_lag2'] = df['breath_id__u_in_lag2'] * df['breath_id_lag2same']


    df['time_step_diff'] = df.groupby('breath_id')['time_step'].diff().fillna(0)
    df['ewm_u_in_mean'] = (df\
                           .groupby('breath_id')[['u_in']]\
                           .ewm(halflife=9)\
                           .mean()\
                           .reset_index(level=0,drop=True))
    df[['15_in_sum', '15_in_min', '15_in_max', '15_in_mean']] = (df\
                                                                 .groupby('breath_id')['u_in']\
                                                                 .rolling(window=15, min_periods=1)\
                                                                 .agg({'15_in_sum':'sum',
                                                                       '15_in_min':'min',
                                                                       '15_in_max':'max',
                                                                       '15_in_mean':'mean'})\
                                                                 .reset_index(level=0, drop=True))
    

    df['u_in_lagback_diff1'] = df['u_in'] - df['u_in_lag_back1']
    df['u_in_lagback_diff2'] = df['u_in'] - df['u_in_lag_back2']
    

    df['R'] = df['R'].astype(str)
    df['C'] = df['C'].astype(str)
    df['R__C'] = df["R"].astype(str) + '__' + df["C"].astype(str)
    df = pd.get_dummies(df)

    return df

train = add_features(train_df)
test = add_features(test_df)
del train_df, test_df
gc.collect()
```

### gb-nb008
- ã‚ˆãã‚ã‚‹ç‰¹å¾´é‡ä½¿ã£ã¦ã‚‹
- 

### gb-nb011
- cv: 0.165083407259815, 0.15780835227398698, 0.16185144929734957, 0.1552711538175763, 0.15557388985375448, 0.15929822242330105, 0.15952012520386283, 0.1571477531343505, 0.15855710421709027
- 0.1589


### gb-nb015
- make fft features
    - abs(log(features))
    - features = fft, fft_w, fft_cos, fft_cos_w

### datasets/train(test)_fft.pkl
- abs(log(features))
- features = fft, fft_w, fft_cos, fft_cos_w

### datasets/train(test)_fft_clip.pkl
- abs(log(features))
- features = fft, fft_w, fft_cos, fft_cos_w
- clipped
    - df['fft'] = df['fft'].clip(0,10)
    - df['fft_w'] = df['fft_w'].clip(0,15)
    - df['fft_cos'] = df['fft_cos'].clip(0,20)
    - df['fft_cos_w'] = df['fft_cos_w'].clip(0,25)


## 20211027
### gb-nb016
- 0.1593, 0.1615, 0.1581, 0.1624, 0.1569, 0.1562, 0.1581, 0.1588, 0.1579, 0.1578
- cv: 0.1587

## 20211028
### datasets/train[test]_fft_physics.pkl
```
def add_features(df):
    df['cross']= df['u_in']*df['u_out']
    df['cross2']= df['time_step']*df['u_out']
    df['area'] = df['time_step'] * df['u_in']
    df['area'] = df.groupby('breath_id')['area'].cumsum()
    df['time_step_cumsum'] = df.groupby(['breath_id'])['time_step'].cumsum()
    df['u_in_cumsum'] = (df['u_in']).groupby(df['breath_id']).cumsum()


    df['u_in_lag1'] = df.groupby('breath_id')['u_in'].shift(1)
    df['u_in_lag_back1'] = df.groupby('breath_id')['u_in'].shift(-1)
    df['u_in_lag2'] = df.groupby('breath_id')['u_in'].shift(2)
    df['u_in_lag_back2'] = df.groupby('breath_id')['u_in'].shift(-2)
    df['u_in_lag3'] = df.groupby('breath_id')['u_in'].shift(3)
    df['u_in_lag_back3'] = df.groupby('breath_id')['u_in'].shift(-3)
    df['u_in_lag4'] = df.groupby('breath_id')['u_in'].shift(4)
    df['u_in_lag_back4'] = df.groupby('breath_id')['u_in'].shift(-4)

    df = df.fillna(0)
    
    df['breath_id__u_in__max'] = df.groupby(['breath_id'])['u_in'].transform('max')
    df['breath_id__u_out__max'] = df.groupby(['breath_id'])['u_out'].transform('max')
    df['breath_id__u_in__diffmax'] = df.groupby(['breath_id'])['u_in'].transform('max') - df['u_in']
    df['breath_id__u_in__diffmean'] = df.groupby(['breath_id'])['u_in'].transform('mean') - df['u_in']

    df['u_in_diff1'] = df['u_in'] - df['u_in_lag1']
    df['u_in_diff2'] = df['u_in'] - df['u_in_lag2']
    df['u_in_diff3'] = df['u_in'] - df['u_in_lag3']
    df['u_in_diff4'] = df['u_in'] - df['u_in_lag4']
    
    df['one'] = 1
    df['count'] = (df['one']).groupby(df['breath_id']).cumsum()
    df['u_in_cummean'] = df['u_in_cumsum'] / df['count']
    
    df['breath_id_lag'] = df['breath_id'].shift(1).fillna(0)
    df['breath_id_lag2'] = df['breath_id'].shift(2).fillna(0)
    df['breath_id_lagsame'] = np.select([df['breath_id_lag']==df['breath_id']],[1],0)
    df['breath_id_lag2same'] = np.select([df['breath_id_lag2']==df['breath_id']], [1], 0)
    df['breath_id__u_in_lag'] = df['u_in'].shift(1).fillna(0)
    df['breath_id__u_in_lag'] = df['breath_id__u_in_lag'] * df['breath_id_lagsame']
    df['breath_id__u_in_lag2'] = df['u_in'].shift(2).fillna(0)
    df['breath_id__u_in_lag2'] = df['breath_id__u_in_lag2'] * df['breath_id_lag2same']


    df['time_step_diff'] = df.groupby('breath_id')['time_step'].diff().fillna(0)
    df['ewm_u_in_mean'] = (df\
                           .groupby('breath_id')[['u_in']]\
                           .ewm(halflife=9)\
                           .mean()\
                           .reset_index(level=0,drop=True))
    df[['15_in_sum', '15_in_min', '15_in_max', '15_in_mean']] = (df\
                                                                 .groupby('breath_id')['u_in']\
                                                                 .rolling(window=15, min_periods=1)\
                                                                 .agg({'15_in_sum':'sum',
                                                                       '15_in_min':'min',
                                                                       '15_in_max':'max',
                                                                       '15_in_mean':'mean'})\
                                                                 .reset_index(level=0, drop=True))
    

    df['u_in_lagback_diff1'] = df['u_in'] - df['u_in_lag_back1']
    df['u_in_lagback_diff2'] = df['u_in'] - df['u_in_lag_back2']
    

    df['R'] = df['R'].astype(str)
    df['C'] = df['C'].astype(str)
    df['R__C'] = df["R"].astype(str) + '__' + df["C"].astype(str)
    df = pd.get_dummies(df)

    df['exponent']=(- df['time_step'])/(df['R']*df['C'])
    df['factor']=np.exp(df['exponent'])
    df['vf']=(df['u_in_cumsum']*df['R'])/df['factor']
    df['vt']=0
    df.loc[df['time_step'] != 0, 'vt']=df['area']/(df['C']*(1 - df['factor']))
    df['v']=df['vf']+df['vt']

    return df
Index(['time_step', 'u_in', 'u_out', 'pressure', 'cross', 'cross2', 'area',
       'time_step_cumsum', 'u_in_cumsum', 'u_in_lag1', 'u_in_lag_back1',
       'u_in_lag2', 'u_in_lag_back2', 'u_in_lag3', 'u_in_lag_back3',
       'u_in_lag4', 'u_in_lag_back4', 'breath_id__u_in__max',
       'breath_id__u_out__max', 'breath_id__u_in__diffmax',
       'breath_id__u_in__diffmean', 'u_in_diff1', 'u_in_diff2', 'u_in_diff3',
       'u_in_diff4', 'u_in_cummean', 'breath_id__u_in_lag',
       'breath_id__u_in_lag2', 'time_step_diff', 'ewm_u_in_mean', '15_in_sum',
       '15_in_min', '15_in_max', '15_in_mean', 'u_in_lagback_diff1',
       'u_in_lagback_diff2', 'R_20', 'R_5', 'R_50', 'C_10', 'C_20', 'C_50',
       'R__C_20__10', 'R__C_20__20', 'R__C_20__50', 'R__C_50__10',
       'R__C_50__20', 'R__C_50__50', 'R__C_5__10', 'R__C_5__20', 'R__C_5__50',
       'fft', 'fft_w', 'fft_cos', 'fft_cos_w', 'exponent', 'factor', 'vf',
       'vt', 'v'],
      dtype='object')
```

### nb021
- ã‚¢ãƒ³ã‚µãƒ³ãƒ–ãƒ«ç”¨

### gb-nb019
```
col = ['u_in_diff1', 
       'u_in_diff2', 
       'u_in', 
       'u_in_lag1', 
       'u_in_lag_back1',
       'u_in_lag_back2',
       'u_in_cumsum',
       ]
deviation, zscore, median

ç‰¹å¾´é‡75å€‹
```
- ãƒ¡ãƒ¢ãƒªã‚¨ãƒ©ãƒ¼ã¨ç‰¹å¾´é‡ã®æ•°
    - 75ã‚»ãƒ¼ãƒ•
    - 87ã‚¢ã‚¦ãƒˆ
    - 82ã‚¢ã‚¦ãƒˆ

### gb-nb021
```
col = ['u_in_diff1', 
       'u_in_diff2', 
       'u_in_diff3', 
       'u_in', 
       'u_in_lag1', 
       'u_in_cumsum',
       ]
deviation, zscore, std
```
- 15fold

### gb-nb020
- gb-nb016ã®ãƒ¢ãƒ‡ãƒ«ã®æ´»æ€§åŒ–é–¢æ•°ã‚’ seluâ†’gelu ã«ã—ãŸ
- 0.1581, fold2ãŒã†ã¾ãè¡Œã‹ãªã‹ã£ãŸ

### gb-nb022
- æ¨ªã«GRUã‹ã‚‰æ¨ªã«LSTM layer2å±¤å¢—ã‚„ã—ãŸ

### gb-nb023
- GRUã‚’å…¨ã¦LSTMã«å¤‰æ›´
- Multiply â†’ Average(ã†ã¾ãè¡Œã‹ãªã„æ°—ãŒã™ã‚‹)(ã†ã¾ãè¡Œã£ãŸã‚)
- 0.1585, 0.1609, 0.1593, 0.1595, 0.1555, 0.1545, 0.1570, 0.1608, 0.1567, 0.1598
- 0.15825
- batch_size = 512
- seed = 71
- fold = 10

### gb-nb024
- Average + GRU
- 0.1597, 0.1652, 0.1601, 0.1577

### gb-nb028[æ—§]
- from nb023
- batch_size = 128
- seed = 771
- fold = 10
- 0.1621



### gb-nb026[WIP]
- from nb023
- batch_size: 256
- seed = 72
- fold = 15
- 0.1544, 0.1595, 0.1590, 0.1573, 0.1561, 0.1538

### gb-nb028[WIP]
- batch_size = 512
- seed = 771
- fold = 15
- 0.1597, 0.1572, 0.1563, 0.1599

### gb-nb032[WIP]
- from nb023
- batch_size = 256
- seed = 7
- fold = 10
- 0.1581, 0.1600, 0.1590, 0.1567, 0.1581, 0.1582

### gb-kaggle-nb016
- batch_size = 512
- seed = 700
- fold = 15
- 
